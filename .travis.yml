language: ruby

sudo: false
dist: trusty

rvm:
  - 2.3.0

# Allow Emacs snapshot builds to fail and don't wait for these
matrix:
  fast_finish: true
  allow_failures:
    - env: EMACS_VERSION=snapshot

# Cache stable Emacs binaries and packages
cache:
  bundler: true
  apt: true
  timeout: 691200
  directories:
      - "$HOME/emacs"
      - "$HOME/.emacs.d"

git:
  depth: 1

env:
  matrix:
    - EMACS_VERSION=24.3
    - EMACS_VERSION=24.4
    - EMACS_VERSION=24.5
    - EMACS_VERSION=25.1
    - EMACS_VERSION=25.2
    - EMACS_VERSION=snapshot
    - TEXINFO_VERSION=6.1
  global:
    # Maximum number of executing procesors
    - MAKE_JOBS=$(getconf _NPROCESSORS_ONLN)

before_install:
  # Configure $PATH: Executables are installed to $HOME/bin
  - export PATH="$HOME/bin:$PATH"

before_script:
  # Make sure the exact Emacs version can be found in the build output
  - $(command -v emacs) --version | head -1

script:
  - '[[ ! -n $EMACS_VERSION ]] || make -s -f emacs-travis.mk install_emacs'
  - '[[ ! -n $TEXINFO_VERSION ]] || make -s -f emacs-travis.mk install_texinfo'
  - make -f emacs-travis.mk test

addons:
  apt:
    packages:
      - libperl-dev
